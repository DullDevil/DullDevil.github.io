---
title: 命令行
categories: [神兵利器]
---

- TOC
{:toc}

## 常规命令
**输出系统的所有信息**

```shell
osascript -e "system info"  
```

**系统的 IPv4 的地址**

```shell
osascript -e "IPv4 address of (system info)"
```

**命令行内容输出到文本**

```shell
osascript -e "IPv4 address of (system info)" | col -b > test.txt
```

**获取设备列表**
```shell
idevice_id -l | head -n1
```

**mac sierra 未知来源软件**

```shell
sudo spctl --master-disable
```

**生成sshkey**

```shell
ssh-keygen -t rsa -C "username@email.com"
```

**测试端口**

```shell
nc -zv 192.168.4.207 61613
```

**操作plist文件**  

查看
```shell
/usr/libexec/PlistBuddy -c Print file.plist
```

修改

```shell
/usr/libexec/PlistBuddy -c "Set :CFBundleVersion 1.0" file.plist
```

**设置别名**

```shell
alias mysql=/usr/local/mysql/bin/mysql
```

**自动填充**

```
#!/usr/bin/expect

set timeout 1200
set password izhuan123QWEdsa
set downloadFileName [lindex $argv 0]
set localPath [lindex $argv 1]
spawn scp root@120.26.106.167:/usr/local/tomcats/tomcat8-80-ssl/webapps/app/qualitydev/${downloadFileName} $localPath
expect {
  # 第一次使用scp时 会提示授权
    "yes/no" { send "yes\r"; exp_continue}
    "password:" { send "$password\r" }
}
expect eof
```

**连接命令行**

```shell
ln -s /Users/zhanggy/anaconda3/bin/xunique xunique
```

**文本截取**

```shell
sed -n "/^<plist/,/<\/plist$/p"
```

## openssl

**创建CA机构**

为CA生成私钥

```shell
openssl genrsa -out ca-key.pem -des 1024
```

通过CA私钥生成CSR

```shell
openssl req -new -key ca-key.pem -out ca-csr.pem
```

通过CSR文件和私钥生成CA证书

```shell
openssl x509 -req -in ca-csr.pem -signkey ca-key.pem -out ca-cert.pem
```


**创建服务器端证书**

为服务器生成私钥

```shell
 openssl genrsa -out server-key.pem 1024
```

利用服务器私钥文件服务器生成CSR

```shell
 openssl req -new -key server-key.pem -config openssl.cnf -out server-csr.pem
```

这一步非常关键，你需要指定一份openssl.cnf文件。可以用这个

```
[req]  
    distinguished_name = req_distinguished_name  
    req_extensions = v3_req  

    [req_distinguished_name]  
    countryName = Country Name (2 letter code)  
    countryName_default = CN  
    stateOrProvinceName = State or Province Name (full name)  
    stateOrProvinceName_default = BeiJing  
    localityName = Locality Name (eg, city)  
    localityName_default = YaYunCun  
    organizationalUnitName  = Organizational Unit Name (eg, section)  
    organizationalUnitName_default  = Domain Control Validated  
    commonName = Internet Widgits Ltd  
    commonName_max  = 64  

    [ v3_req ]  
    basicConstraints = CA:FALSE  
    keyUsage = nonRepudiation, digitalSignature, keyEncipherment  
    subjectAltName = @alt_names  

    # 要匹配的域名，可以做二级域名通配
    [alt_names]  
    IP.1 = 127.0.0.1
    DNS.1 = *.domain.net

```

通过服务器私钥文件和CSR文件生成服务器证书

```shell
 openssl x509 -req -CA ca-cert.pem -CAkey ca-key.pem -CAcreateserial -in server-csr.pem -out server-cert.pem -extensions v3_req -extfile openssl.cnf
```

**格式转换**

DER -> PEM

```shell
openssl x509 -in cert.cer -inform DER -outform PEM -out cert.pem
```

PEM -> DER

```shell
openssl x509 -in ca-cert.pem -inform PEM -out cert.der -outform DER
```

打包p12

```shell
openssl pkcs12 -export -in server-cert.pem -out cert.p12 -inkey server-key.pem
```

## pods

安装Cocoapods

```shell
sudo gem install cocoapods
```

初始化

```shell
pod setup
```

查看本地的pods仓库

```shell
pod repo
```

更新pods仓库

```shell
pod repo update master
```

**pod install速度慢的终极解决方案**

git设置全局代理

```shell
git config --global http.proxy socks5://127.0.0.1:1080
```

只需要github上的代码库走代理

```shell
git config --global http.https://github.com.proxy socks5://127.0.0.1:1080
```

如果要恢复/移除上面设置的git代理，使用如下命令

```shell
git config --global --unset http.proxy
git config --global --unset http.https://github.com.proxy
```

**pod search 出错**

```shell
[!] Unable to find a pod with name, author, summary, or description matching `AFNetworking`
```

删除cocoapods的索引，然后重新search，

```
rm ~/Library/Caches/CocoaPods/search_index.json

pod search AFNetworking
```

**更新cocoapods版本时出现**

```
xuanxuandeMacBook-Pro:Specs xuanxuan$ sudo gem update cocoapods  
Updating installed gems
Updating cocoapods
ERROR:  While executing gem ... (Errno::EPERM)
    Operation not permitted - /usr/bin/xcodeproj

```

用下面的命令

```shell
http://stackoverflow.com/questions/30812777/cannot-install-cocoa-pods-after-uninstalling-results-in-error/30851030#30851030
sudo gem install -n /usr/local/bin cocoapods --pre
```


## 私有pods仓库
创建podspec

```shell
pod spec create
```

验证spec文件有效性

```shell
pod spec lint .podspec
```

添加私有repo到CocoaPods中

```shell
pod repo add 'REPO_NAME' 'SOURCE_URL'
```

验证私有repo安装无误

```shell
cd ~/.cocoapods/repos/REPO_NAME
pod repo lint .
```

## Xcode

打包脚本设置bulid路径

```shell
xcodebuild SYMROOT=buildDir
```

启动运行模拟器

```shell
xcrun instruments -w 'iPhone 6 Plus'
```

在已经启动好的模拟器中安装应用：（*这里要特别注意，是app，不是ipa* 安装时需要提供的是APP的文件路径）

```shell
xcrun simctl install booted Calculator.app
```

卸载APP的命令

```shell
xcrun simctl uninstall booted com.yuchang.calculator
```

## 逆向工程

检验app是否加密

```shell
otool -l /Users/limingwei/Desktop/wechat/WeChat | grep crypt

cryptoff 16384
cryptsize 45678592
cryptid 0
```

导出头文件

```shell
class-dump -H *.decrypted -o */classdump/ 
```


lipo 分离/合并 ARMV7、ARM64架构dylib

```shell
分离
lipo -thin armv7 xxxx.dylib -output xxxx_v7.dylib
lipo -thin arm64  xxxx.dylib -output xxxx_64.dylib
合并
lipo -create ./xxxx_v7.dylib ./xxxx_64.dylib -output ./xxxx.dylib
```

查看依赖库

```shell
otool -L /Users/limingwei/Desktop/wechat/WeChat.dylib
```

动态注入

```shell
install_name_tool -add_rpath @loader_path/libsunstrate.dylib /Users/limingwei/Desktop/wechat/WeChat.dylib
```

重签名

```shell
./ios_resign_from_app_to_ipa app-extracted "iPhone Distribution: Hangzhou Jing CAI Network Technology Co., Ltd" embedded.mobileprovision resign.ipa
```

生成Tweak.xm

```shell
logify.pl /path/to/BaseMsgContentViewController.h > /out/to/Tweak.xm
```

**查看页面视图层级**

进入 #cy 模式

```shell
cycript -p 进程序列号
```

打印页面视图层级

```shell
#cy UIApp.keyWindow.recursiveDescription().toString()
```

**MAC OSX 开启/禁用SafeSleep功能**
如果想要禁用，我们需要在终端中输入下面的命令：

```
sudo pmset -a hibernatemode 0
```

然后定位到/private/var/vm/删除已经存在的sleepimage文件

```
cd /private/var/vm/
```

使用下面的命令删除该文件

```
sudo rm sleepimage
```

最后我们要防止OS X继续创建该文件，所以我们需要下面的命令生成一个无法被替换的空文件

```
touch sleepimage
chmod 000 /private/var/vm/sleepimage
```
当然，如果你想要重新开启SafeSleep功能，只需下面的命令即可。

```
sudo pmset -a hibernatemode 3
sudo rm /private/var/vm/sleepimage
```

禁用后可以清理出很大硬盘空间
