---
title : iOS 中的 MVC & MVVM
---



MVC是构建iOS app的标准模式。Model-View-Controller是一个用来组织代码的权威范式。Apple甚至是[这么说的](https://developer.apple.com/library/ios/documentation/general/conceptual/devpedia-cocoacore/MVC.html)。在MVC下，所有的对象被归类为一个model，一个view，或一个controller。Model持有数据，View显示与用户交互的界面，而view controller调解model和view之间的交互。

## iOS中的MVC
### M-V-C的职责划分





![](https://raw.githubusercontent.com/DullDevil/pics/master/MVC/MVC-1.png)



Model

模型对象封装了特定于应用程序的数据，定义了处理数据的逻辑。这个Apple 官方的解释，但是在实际开发中的model往往是很薄的一层，只定义了一些属性。



View

视图对象是用户可以看到的应用程序中的对象。视图对象知道如何绘制自己，并能够响应用户操作。视图对象的一个主要目的是从应用程序的模型对象中显示数据，并启用对数据的编辑。



Controller

控制器对象充当应用程序的视图对象中的一个或多个与其一个或多个模型对象之间的中介。因此，控制器对象是一个管道，通过它，视图对象了解模型对象的变化，反之亦然。控制器对象还可以为应用程序执行设置和协调任务，并管理其他对象的生命周期。



### M-V-C的交流方式

![](https://raw.githubusercontent.com/DullDevil/pics/master/MVC/MVC-2.jpeg)



Model - View

Model 和 View 没有交流，Model 并不关系自己是以什么样的方式显示出来，View 也不关系自己显示的到底是什么。



Controller - Model

Controller 持有Model，可以访问Model 所有的公开API。Model 可以通过 Notification或者KVO的方式通知Controller 有数据更新，然后Controller会主动向Model获取新数据。



Controller - View

Controller 持有View，控制View 的显示逻辑和内容。通过 tartget-action 的方式处理View 上的触摸事件，用代理的方式接受View 的事件委托和为View 提供数据。



### 通常开发中存在的问题

#### 1.ViewController 相当臃肿

ViewController 不仅要控制视图，也要做数据处理。

ViewController 不仅要控制View 的显示，也要记录View 显示相关的数据，比如按钮的显示隐藏，tableview 的 data 数据。

格式化数据，比如说，view 要显示一个 用户ID 格式为 “用户ID ：123”，但是在model 中的数据可能就只有一个 “123”，那这个格式话的过程就要在ViewController中处理

网络请求，放在model 中？由于异步请求，会导致Model 的生命周期变长。放在View里？View 只负责显示的，不关心数据从哪里来。这个网络请求实在是没地方放了，只能在ViewController中处理。

ViewController中存在大量的记录属性


#### 2.不好测试

由于view controller混合了视图处理逻辑和业务逻辑，分离这些成分的单元测试成了一个艰巨的任务。大多数人选择忽略这个任务，那就是不做任何测试。



#### 3.界面难以复用

在iOS中用户看到的界面都是通过ViewController呈现的，所有的控件都是放在ViewController 的 View 上的。在开发的过程中，如果两个界面样式相同，并且用户交互也相同，那就会考略重用。但是往往界面和交互相同，但是数据的处理逻辑却不同，以至于相同或相似的界面就会有两个ViewController。



## MVVM

![](https://raw.githubusercontent.com/DullDevil/pics/master/MVC/MVVM.png)



在MVVM里，view和ViewController正式联系在一起，我们把它们视为一个组件。视图view仍然不能直接引用模型model，当然controller也不能。相反，他们引用视图模型view model。

MVVM来源于MVC，将Controller 中的一部分工作交给ViewModel来处理，减轻了Controller的负担。ViewModel可以放置用户输入验证逻辑，视图显示逻辑，发起网络请求和其他各种各样的代码的极好的地方。但是ViewModel不能引用视图，换句话说，不要在ViewModel中不要导入UIKit.h

使用MVVM的iOS app是高度可测试的；因为ViewModel包含了所有的展示逻辑并且不会引用view，所以它可以通过编程方式充分测试。

增强了界面的复用性，把一些数据和业务的处理逻辑抽离出来之后，ViewController 中只包含了页面的显示和界面的交互逻辑，所以相同或相似的界面就可以进行复用，如果有必要的话，可以通过协议的方式来约束ViewModel。

虽然MVVM会增加一点代码量，但是从整体上来说还是很划算的。
