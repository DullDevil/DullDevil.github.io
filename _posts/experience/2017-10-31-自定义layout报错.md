---
title: 自定义layout
categories: [聚沙成塔]
---


#### 区头悬停
在 iOS9 之后 UICollectionViewFlowLayout 会支持区头的悬停，只需要要设置

```
layout.sectionHeadersPinToVisibleBounds = YES;
```

如果设置了区头悬停，即使
```
- (BOOL)shouldInvalidateLayoutForBoundsChange:(CGRect)newBounds {
    return YES;
}
```

在滚动的时候，下面的方法也不会调用

```
- (void)prepareLayout;
```

#### prepareLayout

#### 警告处理
自定义layout的时候会有错误：

```
Logging only once for UICollectionViewFlowLayout cache mismatched frame
This is likely occurring because the flow layout subclass ***  is modifying attributes returned by UICollectionViewFlowLayout without copying them
```

解决：

既然错误原因是没copy 那就 copy 一下

```
- (NSArray *)layoutAttributesForElementsInRect:(CGRect)rect {
    NSMutableArray *allAttributesInArray = [NSMutableArray array];

    NSArray *attribs = [super layoutAttributesForElementsInRect:rect];
    for (UICollectionViewLayoutAttributes *attributes in attribs) {
        if (CGRectIntersectsRect(attributes.frame, rect)) {
            UICollectionViewLayoutAttributes* attributesCopy = [attributes copy];
            attributesCopy.bounds = CGRectMake(0, 0, CGRectGetWidth(attributes.bounds)/2.0, CGRectGetHeight(attributes.bounds) * 0.8);
            [allAttributesInArray addObject:attributesCopy];
        }
    }

    return allAttributesInArray;
}
```
